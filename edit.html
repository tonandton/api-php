<!doctype html>
<html lang="en">

<head>
     <!-- Required meta tags -->
     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     <!-- Bootstrap CSS -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

     <title>Hello, world!</title>
</head>

<body onload="user_read()">

     <div class="container">
          <div class="row">
               <h1>Update</h1>
               <form class="row g-3" onsubmit="return false">
                    <div class="mb-3">
                         <label for="id" class="form-label">ID</label>
                         <input type="text" class="form-control" id="id" placeholder="ID" disabled>
                    </div>
                    <div class="mb-3">
                         <label for="f_name" class="form-label">First Name</label>
                         <input type="text" class="form-control" id="f_name" placeholder="First Name">
                    </div>
                    <div class="mb-3">
                         <label for="l_name" class="form-label">Last Name</label>
                         <input type="text" class="form-control" id="l_name" placeholder="Last Name">
                    </div>
                    <div class="mb-3">
                         <label for="username" class="form-label"> Username</label>
                         <input type="email" class="form-control" id="username" placeholder="Username">
                    </div>
                    <div class="mb-3">
                         <label for="password" class="form-label">password</label>
                         <input type="password" class="form-control" id="password" placeholder="Password">
                    </div>
                    <div class="mb-3">
                         <label for="avatar" class="form-label">Profile</label>
                         <input type="text" class="form-control" id="avatar" placeholder="Profile">
                    </div>
                    <button type="button" onclick="user_update()" class="btn btn-primary mb-3">Update</button>
               </form>
          </div>
     </div>

     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>

</body>

</html>
<script>
     let user_read = function () {
          const params = new URLSearchParams(window.location.search);
          const id = params.get('id');
          let requestOptions = {
               method: "GET",
               redirect: "follow"
          }

          fetch("http://localhost/api-php/api/users/read.php?id=" + id, requestOptions)
               .then(res => res.json())
               .then(result => {
                    let user = result[0];
                    document.getElementById("id").value = user.id;
                    document.getElementById("f_name").value = user.f_name;
                    document.getElementById("l_name").value = user.l_name;
                    document.getElementById("username").value = user.username;
                    document.getElementById("password").value = user.password;
                    document.getElementById("avatar").value = user.avatar;

               })
               .catch(error => console.log('error', error));
     }

     let user_update = function () {
          const params = new URLSearchParams(window.location.search);
          const id = params.get('id');

          let myHeaders = new Headers();
          myHeaders.append("Content-Type", "application/json");

          let raw = JSON.stringify({
               "id": id,
               "f_name": document.getElementById("f_name").value,
               "l_name": document.getElementById("l_name").value,
               "username": document.getElementById("username").value,
               "password": document.getElementById("password").value,
               "avatar": document.getElementById("avatar").value
          })

          fetch("http://localhost/api-php/api/users/update.php", {
               method: 'PATCH',
               headers: myHeaders,
               body: raw,
               redirect: 'follow'
          })
               .then(res => res.json())
               .then(result => {
                    if (result.status === 'success') {
                         alert("update success");
                         window.location.href = "index.html";
                    } else {
                         alert("error");
                    }

               })
               .catch(error => console.log('error', error));
     }
</script>